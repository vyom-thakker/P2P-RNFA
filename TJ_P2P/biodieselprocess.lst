GAMS Rev 235  WEX-VS8 23.5.1 x86/MS Windows             08/13/19 14:45:02 Page 1
: Biodiesel TES Model - 1/19/2017
C o m p i l a t i o n


      Author: Tapajyoti Ghosh
      P2P TES work for the AICHE 2017
   6   
   7   
  10   
  11  Options LimRow = 70, LimCol = 0;
  12   
  13   
  14  Set
  15  *Global settings
  16  *        Define units: Src=source, Snk=sink, Mix=mixer, Spl=splitter
  17  *                      Str=storage, HX = Heat exchangers
  18   
  19           unit    units
  20           /Reactor3, Reactor4, Sep2*Sep3, Mix2*Mix3, Col3*Col5,
  21            Snk3*Snk7, Src3, Src5, Src6, Spl3, Src, HX10*HX23, HX45, Src7, C
      HP, SrcWa, Wetland/
  22   
  23  *        Define subsets of units
  24           HX(unit) heat exchangers
  25          /HX10*HX23, HX45 /
  26   
  27           Mix(unit) mixers
  28           /Mix2*Mix3/
  29   
  30           Spl(unit) splitter
  31           /Spl3/
  32   
  33           Src(unit) sources
  34           /Src3, Src5, Src6, Src, Src7/
  35   
  36           Snk(unit) sinks
  37           /Snk3*Snk7/
  38   
  39           Sep(unit) separators
  40           /Sep2*Sep3/
  41   
  42           Column(unit) distillation columns
  43           /Col3*Col5/
  44   
  45   
  46  *        Define Components
  47           J       components
  48           /Wa, MeOH, Glycerol, KOH, Oil, FFA, FAME, PhosA, PotPhos/
  49   
  50  *        Define Reactions: KOH_Neut - neutralization reaction of KOH with 
      phosphoric acid
  51           react
  52           /KOH_neut/
  53   
  54  *        running variable for vapor pressure correlation
  55           l /1*3/
  56   
  57  *         Pollutant emissions
  58           K       Pollutants
  59           /NO2, SO2, PM10, CO2, O3, GWater/
  60   
  61  *        running variable for flux correlation
  62           p  /1*3/
  63   
  64  Alias(unit, unit1)
  65  Alias (J,h)
  66   
  67   
  68  Parameters
  69  *        individual liquid heat capacity of a component (average in a rang
      e 20 C - 100 C)
  70  *        in kJ/(kg*C), assume: constant heat capacities and c_p_ind('CellM
      ')=c_p_ind('Wa')
  71   
  72           c_p_ind(J)
  73           /Wa             4.19
  74            MeOH           2.534
  75            Glycerol       2.409
  76            KOH            1.179
  77            Oil            2.000
  78            FFA            2.07
  79            FAME           2.01
  80            PhosA          1.758
  81            PotPhos        4.07/
  82   
  83  *        Molecular weight in g/mol
  84           MW(J)
  85           /Wa             18.015
  86            MeOH           32.04
  87            Glycerol       92.093
  88            KOH            56.1056
  89            Oil            920
  90            FFA            280.5
  91            FAME           292.2
  92            PhosA          98
  93            PotPhos        174.18/
  94   
  95   
  96  *        Standard heats of vapourization Kj/Kg
  97           dH_vap_0(J)
  98           /Wa             2254
  99            MeOH           1000
 100            Glycerol       974
 101            Oil            170.137
 102            FAME           460/;
 103   
 104   
 105   
 106  Table
 107  *        vapor pressure coefficients: mmHq, T= C
 108  *        750 mmHq = 1bar, 760mmHq = 1atm
 109  *        ln(p_k)j= coef_p(h,1)-coef_p(h,2)/(T+coef_p(h,3))
 110           coef_p(J,l)
 111                        1       2       3
 112           Wa         5.0768  1659.73  -45.854
 113           MeOH       5.20409 1581.341 -33.50
 114           Oil        11.4785 -708.72  -167.48
 115           FAME       8.2175  1450.62  88.03
 116           Glycerol   41.9806 6024.4   10.3272
 117           KOH        7.06223 6300.48  172.76
 118           FFA        3.82846 2066.995 -116.87;
 119   
 120  *FAME in K, MeOH in K, Oil in K, Wa in K, KOH in C, FFA in K
 121  *MeOH in bar, FAME in Pa, Oil in Pa, glycerol in Torr, Wa in bar, KOH in m
      mHg, FFA in bar;
 122  *** NOTE ANTOINE EQUATION FOR OIL AND GLYCEROL ARE SLIGHTLY DIFF FROM THE 
      ORIGINAL EQUATION **
 123  *Vp for KOH is coming to zero now
 124  * KOH - KOH        4.02783 5854.906 144.113
 125   
 126  SET      Arc(unit,unit1) stream matrix;
 127   
 128  *setting entries in stream matrix
 129  ***Arc is unknown symbol***
 130  Arc(unit, unit1)=No;
 131   
 132  *Define all existing streams Arc('1','2') is stream from unit 1 to unit 2
 133   
 134   
 135  *Feed to reactors
 136  Arc('Mix2','Mix3') = Yes;
 137  Arc('Src','Mix3') = Yes;
 138  Arc('Col3','Mix2') = Yes;
 139  Arc('Src3','Mix2') = Yes;
 140  Arc('Mix3','HX45') = Yes;
 141  Arc('Src5','Mix3') = Yes;
 142   
 143  *Reaction transesterification unit
 144  Arc('HX45','Reactor3') = Yes;
 145  Arc('Mix3','HX45') = Yes;
 146  Arc('Reactor3','HX10') = Yes;
 147   
 148  *MeOH distillation unit
 149  Arc('HX10','Col3') = Yes;
 150  Arc('Col3','HX13') = Yes;
 151  Arc('Col3','Mix2') = Yes;
 152   
 153  *Washing
 154  Arc('HX13','Sep2') = Yes;
 155  Arc('Src6','Sep2') = Yes;
 156  Arc('Sep2','Reactor4') = Yes;
 157  Arc('Sep2','HX19') = Yes;
 158  Arc('SrcWa','Src6') = Yes;
 159   
 160  *Neutralization alkali
 161  Arc('Reactor4','HX14') = Yes;
 162  Arc('Src7','Reactor4')  = Yes;
 163  Arc('Reactor4','Snk3') = Yes;
 164   
 165  *FAME Distillation
 166  Arc('HX19','Col5') = Yes;
 167  Arc('Col5','HX22') = Yes;
 168  Arc('Col5','HX23') = Yes;
 169   
 170  *Glycerol distillation
 171  Arc('HX14','Col4') = Yes;
 172  Arc('Col4','HX17') = Yes;
 173  Arc('Col4','HX18') = Yes;
 174   
 175  *Wetland
 176  Arc('Wetland','Src6') = Yes;
 177   
 178  *CHP
 179  Arc('SrcWa','Src6') = Yes;
 180  Arc('Src6','CHP') = Yes;
 181   
 182   
 183   
 184  Positive Variables
 185  *        streams and mass fractions: all in kg/s
 186           F(unit,unit1)           total streams in kg s^-1
 187           fc(J,unit,unit1)        individual components streams
 188           x(J,unit,unit1)         mass fraction of comp J in stream
 189   
 190  *        heat of evaporation
 191           dH_v(J,unit,unit1)      individual heat of vap. (KJ per kg)
 192   
 193  *        vapor pressure
 194           p_v(J,unit,unit1)       vapor pressure in bar
 195   
 196  *        temperatures in C
 197           T(unit,unit1)          temperature of stream in C
 198   
 199  *        Separation efficiencies
 200           Separation(J)                  Separation efficiencies
 201   
 202  Variables
 203  *        heat
 204           Q(Unit)         heat produced or consumed in unit (efficiency inc
      luded)
 205  *         Q_cond(column)  heat load of condenser of column
 206  *         Q_reb(column)   heat load of reboiler of column
 207   
 208           Z               objective function value ;
 209   
 210   
 211  *Defining global bounds and fixing some variables
 212   
 213  *mass fractions
 214  x.UP(J,unit,unit1)$Arc(unit,unit1)=1;
 215   
 216  *Total streams. #Setting this at 1000 but look into Python code for changi
      ng value#
 217  F.up(unit,unit1)$Arc(unit,unit1)=100;
 218  F.lo(unit,unit1)$Arc(unit,unit1) = 0.001;
 219   
 220  *Component streams #Setting this at 1000 but look into Python code for cha
      nging value#
 221  fc.up(J,unit,unit1)$Arc(unit,unit1)=20;
 222  fc.lo(J,unit,unit1)$Arc(unit,unit1)=0.001;
 223   
 224  F.up(unit,unit1)$(not Arc(unit,unit1)) = 0;
 225  fc.up(J,unit,unit1)$(not Arc(unit,unit1)) = 0;
 226   
 227   
 228  *Heat consumption of certain units
 229  Q.Fx('Sep2') = 0;
 230  Q.Fx('Mix2') = 0;
 231  Q.Fx('Mix3') = 0;
 232  Q.Fx('Col3') = 0;
 233  Q.Fx('Col4') = 0;
 234  Q.Fx('Col5') = 0;
 235  Q.Fx('Snk3') = 0;
 236  Q.Fx('Snk4') = 0;
 237  Q.Fx('Snk5') = 0;
 238  Q.Fx('Snk6') = 0;
 239  Q.Fx('Snk7') = 0;
 240  Q.Fx('Src3') = 0;
 241  Q.Fx('Src5') = 0;
 242  Q.Fx('Src7') = 0;
 243  Q.Fx('Spl3') = 0;
 244  Q.Fx('Src') = 0;
 245   
 246  *Global bounds for separation efficiencies of components
 247  *MeOH
 248  Separation.lo('MeOH')  = 0.5;
 249  Separation.up('MeOH') = 0.9999;
 250  Separation.l('MeOH') = (Separation.up('MeOH') + Separation.lo('MeOH'))/2;
 251  *Water
 252  Separation.lo('Wa')  = 0.5;
 253  Separation.up('Wa') = 0.9999;
 254  Separation.l('Wa') = (Separation.up('Wa') + Separation.lo('Wa'))/2;
 255  *Separation of water is always 0.5, so giving it a higher value makes this
       equation infeasible.
 256   
 257  *Glycerol
 258  Separation.lo('Glycerol')  = 0.5;
 259  Separation.up('Glycerol') = 0.9999;
 260  Separation.l('Glycerol') = (Separation.up('Glycerol') + Separation.lo('Gly
      cerol'))/2;
 261  *Oil
 262  Separation.lo('Oil')  = 0.01;
 263  Separation.up('Oil') = 0.3;
 264  Separation.l('Oil') = (Separation.up('Oil') + Separation.lo('Oil'))/2;
 265  *FFA
 266  Separation.lo('FFA')  = 0.01;
 267  Separation.up('FFA') = 0.5;
 268  Separation.l('FFA') = (Separation.up('FFA') + Separation.lo('FFA'))/2;
 269  *KOH
 270  Separation.lo('KOH')  = 0.5;
 271  Separation.up('KOH') = 0.9999;
 272  Separation.l('KOH') = (Separation.up('KOH') + Separation.lo('KOH'))/2;
 273  *FAME
 274  Separation.lo('FAME')  = 0.01;
 275  Separation.up('FAME') = 0.5;
 276  Separation.l('FAME') = (Separation.up('FAME') + Separation.lo('FAME'))/2;
 277   
 278  Scalar
 279           dp                     pressure loss in the column /0.1/
 280           alpha_c4               relative volatility in column 4 /3.8/
 281           alpha_c3                relative volatility in column 3 /4.5/
 282           dhreactn                Neutralization heat Kj per mol /-200.18/
 283           dhreactneu              Neutralization heat in Kh per mol /-173/
 284           washing_wa              Water washing recovery        /0.01/
 285           Temp_cooldown           Cooldown temperature of FAME   /25/
 286           T_amb                   Ambient teperature              /25/;
 287   
 288  *recover_oil             recovery of Oil that is fixed /0.997/
 289  *recover_FAME            recovery of FAME that is fixed /0.997/
 290   
 291  *global temperature bounds - bounds get redefined for specific streams
 292  T.lo(unit,unit1)=0.01;
 293  *Set the lowest temp to be a value greater than zero
 294  T.up(unit,unit1)=300;
 295  T.l(unit, unit1) = (T.lo(unit, unit1) + T.up(unit, unit1))/2;
 296   
 297  *Specifying temperatures in C
 298  T.Fx('Src3','Spl3') = 25;
 299  T.Fx('Spl3','Mix2') = 25;
 300  T.Fx('Src','Mix3') = 60;
 301  T.Fx('Mix3','HX45') = 37.23;
 302  T.Fx('HX11','Mix2') = 28.2;
 303  T.Fx('Src5','Mix3') = 25;
 304  T.Fx('HX45','Reactor3') = 60;
 305  T.Fx('Reactor3','HX10') = 60;
 306  T.Fx('HX10','Col3') = 80;
 307  *T.Fx('Col3','HX13') = 145;
 308  T.Fx('HX13','Sep2') = 60;
 309  T.Fx('Src7','Reactor4') = 60;
 310  T.Fx('Reactor4','Snk3') = 60;
 311  *Temp value from HX14 to Col 4 value needs to be checked again
 312  T.Fx('HX14','Col4') = 60;
 313  T.Fx('HX17','Snk4') = 42.8;
 314  T.Fx('HX16','HX18') = 112;
 315  T.Fx('HX18','Snk5') = 148.6;
 316  T.Fx('Sep2','Reactor4') = 60;
 317  T.Fx('HX19','Col5') = 80;
 318  T.Fx('HX22','Snk6') = 167.8;
 319  T.Fx('Src6','Sep2') = 20;
 320  *Inlet temperature of water
 321   
 322   
 323   
      This section  describes all src streams that have a pre-fixed value. In th
      is model,
      mass flow of methanol stream entering from src3 to mix2, oil from src to m
      ix3, KOH from src5 to mix3
      and Wa from src6 to Sep2 are decision variables
 329  *################################################*************
 330  *fc.up('MeOH','Src3','Mix2') = 0.059137;
 331  *fc.lo('MeOH','Src3','Mix2') = 0.038382;
 332  *################################################*************
 333  fc.up('MeOH','Src3','Mix2') = 2;
 334  fc.lo('MeOH','Src3','Mix2') = 0.01;
 335  fc.l('MeOH','Src3','Mix2') = (fc.lo('MeOH','Src3','Mix2') + fc.up('MeOH','
      Src3','Mix2'))/2;
 336  *fc.L = inital point will be min max of this
 337   
 338  fc.FX('Wa','Src3','Mix2') = 0;
 339  fc.FX('Glycerol','Src3','Mix2') = 0;
 340  fc.FX('KOH','Src3','Mix2') = 0;
 341  fc.FX('Oil','Src3','Mix2') = 0;
 342  fc.FX('FFA','Src3','Mix2') = 0;
 343  fc.FX('FAME','Src3','Mix2') = 0;
 344  fc.FX('PhosA','Src3','Mix2') = 0;
 345  fc.FX('PotPhos','Src3','Mix2') = 0;
 346   
 347  x.FX('MeOH','Src3','Mix2') = 1;
 348   
 349  x.FX('Wa','Src3','Mix2') = 0;
 350  x.FX('Glycerol','Src3','Mix2') = 0;
 351  x.FX('KOH','Src3','Mix2') = 0;
 352  x.FX('Oil','Src3','Mix2') = 0;
 353  x.FX('FFA','Src3','Mix2') = 0;
 354  x.FX('FAME','Src3','Mix2') = 0;
 355  x.FX('PhosA','Src3','Mix2') = 0;
 356  x.FX('PotPhos','Src3','Mix2') = 0;
 357   
 358  ****************
 359   
 360   
 361  fc.FX('Wa','Src5','Mix3') = 0;
 362  fc.FX('MeOH','Src5','Mix3') = 0;
 363  fc.FX('Glycerol','Src5','Mix3') = 0;
 364  fc.FX('Oil','Src5','Mix3') = 0;
 365  fc.FX('FFA','Src5','Mix3') = 0;
 366  fc.FX('FAME','Src5','Mix3') = 0;
 367  fc.FX('PhosA','Src5','Mix3') = 0;
 368  fc.FX('PotPhos','Src5','Mix3') = 0;
 369   
 370  x.FX('KOH','Src5','Mix3') = 1;
 371   
 372  x.FX('Wa','Src5','Mix3') = 0;
 373  x.FX('MeOH','Src5','Mix3') = 0;
 374  x.FX('Glycerol','Src5','Mix3') = 0;
 375  x.FX('Oil','Src5','Mix3') = 0;
 376  x.FX('FFA','Src5','Mix3') = 0;
 377  x.FX('FAME','Src5','Mix3') = 0;
 378  x.FX('PhosA','Src5','Mix3') = 0;
 379  x.FX('PotPhos','Src5','Mix3') = 0;
 380   
 381   
 382   
 383  *Src has only Oil as the input which is a variable
 384  *################################################*************
 385  *fc.up('Oil','Src','Mix3') = 0.59222947;
 386  *fc.lo('Oil','Src','Mix3') = 0.3947620;
 387  *################################################*************
 388  fc.up('Oil','Src','Mix3') = 5;
 389  fc.lo('Oil','Src','Mix3') = 0.01;
 390   
 391  fc.l('Oil','Src','Mix3') = (fc.lo('Oil','Src','Mix3') + fc.up('Oil','Src',
      'Mix3'))/2;
 392  *fc.L
 393   
 394   
 395  fc.FX('Wa','Src','Mix3') = 0;
 396  fc.FX('MeOH','Src','Mix3') = 0;
 397  fc.FX('Glycerol','Src','Mix3') = 0;
 398  fc.FX('KOH','Src','Mix3') = 0;
 399  fc.FX('FFA','Src','Mix3') = 0;
 400  fc.FX('FAME','Src','Mix3') = 0;
 401  fc.FX('PhosA','Src','Mix3') = 0;
 402  fc.FX('PotPhos','Src','Mix3') = 0;
 403   
 404  x.FX('Oil','Src','Mix3') = 1;
 405   
 406  x.FX('Wa','Src','Mix3') = 0;
 407  x.FX('MeOH','Src','Mix3') = 0;
 408  x.FX('Glycerol','Src','Mix3') = 0;
 409  x.FX('KOH','Src','Mix3') = 0;
 410  x.FX('FFA','Src','Mix3') = 0;
 411  x.FX('FAME','Src','Mix3') = 0;
 412  x.FX('PhosA','Src','Mix3') = 0;
 413  x.FX('PotPhos','Src','Mix3') = 0;
 414   
 415   
 416  ************* Water to washing stream ******
 417   
 418  fc.FX('MeOH','Src6','Sep2') = 0;
 419  fc.FX('Glycerol','Src6','Sep2') = 0;
 420  fc.FX('KOH','Src6','Sep2') = 0;
 421  fc.FX('Oil','Src6','Sep2') = 0;
 422  fc.FX('FFA','Src6','Sep2') = 0;
 423  fc.FX('FAME','Src6','Sep2') = 0;
 424  fc.FX('PhosA','Src6','Sep2') = 0;
 425  fc.FX('PotPhos','Src6','Sep2') = 0;
 426   
 427  x.FX('Wa','Src6','Sep2') = 1;
 428   
 429  x.FX('MeOH','Src6','Sep2') = 0;
 430  x.FX('Glycerol','Src6','Sep2') = 0;
 431  x.FX('KOH','Src6','Sep2') = 0;
 432  x.FX('Oil','Src6','Sep2') = 0;
 433  x.FX('FFA','Src6','Sep2') = 0;
 434  x.FX('FAME','Src6','Sep2') = 0;
 435  x.FX('PhosA','Src6','Sep2') = 0;
 436  x.FX('PotPhos','Src6','Sep2') = 0;
 437   
 438   
 439   
 440  *Src7 has PhosA as input which can be
 441  *fc.up('PhosA','Src7','Reactor4') = 200;
 442  *fc.lo('PhosA','Src7','Reactor4') = 0.001;
 443  *fc.l('PhosA','Src7','Reactor4') = (fc.lo('PhosA','Src7','Reactor4') + fc.
      up('PhosA','Src7','Reactor4'))/2;
 444   
 445  fc.Fx('Wa','Src7','Reactor4') = 0;
 446  fc.Fx('MeOH','Src7','Reactor4') = 0;
 447  fc.Fx('Glycerol','Src7','Reactor4') = 0;
 448  fc.Fx('KOH','Src7','Reactor4') = 0;
 449  fc.Fx('Oil','Src7','Reactor4') = 0;
 450  fc.Fx('FFA','Src7','Reactor4') = 0;
 451  fc.Fx('FAME','Src7','Reactor4') = 0;
 452  fc.Fx('PotPhos','Src7','Reactor4') = 0;
 453   
 454  x.Fx('PhosA','Src7','Reactor4') = 1;
 455   
 456  x.Fx('Wa','Src7','Reactor4') = 0;
 457  x.Fx('MeOH','Src7','Reactor4') = 0;
 458  x.Fx('Glycerol','Src7','Reactor4') = 0;
 459  x.Fx('KOH','Src7','Reactor4') = 0;
 460  x.Fx('Oil','Src7','Reactor4') = 0;
 461  x.Fx('FFA','Src7','Reactor4') = 0;
 462  x.Fx('FAME','Src7','Reactor4') = 0;
 463  x.Fx('PotPhos','Src7','Reactor4') = 0;
 464   
 465   
 466  **------- Fixing flow streams for Phosphoric Acid ---- **
 467  fc.Fx('PhosA','Reactor4','HX14') =0;
 468  fc.Fx('PhosA','Sep2','Reactor4') =0;
 469  fc.Fx('PhosA','Mix2','Mix3') =0;
 470  fc.Fx('PhosA','Mix3','HX45') =0;
 471  fc.Fx('PhosA','HX10','Col3') =0;
 472  fc.Fx('PhosA','HX45','Reactor3') =0;
 473  x.Fx('PhosA','Reactor4','HX14') =0;
 474  x.Fx('PhosA','Sep2','Reactor4') =0;
 475  x.Fx('PhosA','Mix2','Mix3') =0;
 476  x.Fx('PhosA','Mix3','HX45') =0;
 477  x.Fx('PhosA','HX10','Col3') =0;
 478  x.Fx('PhosA','HX45','Reactor3') =0;
 479   
 480   
 481   
 482  **------- Fixing flow streams for Potassium Phosphate ---- **
 483  fc.Fx('PotPhos','Mix2','Mix3') = 0;
 484  fc.Fx('PotPhos','Mix3','HX45') = 0;
 485  fc.Fx('PotPhos','HX10','Col3') = 0;
 486  fc.Fx('PotPhos','HX45','Reactor3') = 0;
 487  x.Fx('PotPhos','Mix2','Mix3') = 0;
 488  x.Fx('PotPhos','Mix3','HX45') = 0;
 489  x.Fx('PotPhos','HX10','Col3') = 0;
 490  x.Fx('PotPhos','HX45','Reactor3') = 0;
 491   
 492   
 493  ** ------ Fixing flow of FFA ---- **
 494  fc.Fx('FFA','Col5','HX23') = 0;
 495  x.FX('FFA','Col5','HX23') = 0;
 496   
 497  ** ----------- Fixing glycerol flow stream ---- **
 498  fc.Fx('Glycerol','Mix2','Mix3') = 0;
 499  x.Fx('Glycerol','Mix2','Mix3') = 0;
 500  fc.Fx('Glycerol','Mix3','HX45') = 0;
 501  x.Fx('Glycerol','Mix3','HX45') = 0;
 502  fc.Fx('Glycerol','HX45','Reactor3') = 0;
 503  x.Fx('Glycerol','HX45','Reactor3') = 0;
 504  *fc.Fx('Glycerol','Col4','HX17') = 0;
 505  *x.Fx('Glycerol','Col4','HX17') = 0;
 506   
 507  ** ------ Fixing FAME flow streams ---**
 508  fc.Fx('FAME','Mix2','Mix3') = 0;
 509  x.Fx('FAME','Mix2','Mix3') = 0;
 510  fc.Fx('FAME','Mix3','HX45') = 0;
 511  x.Fx('FAME','Mix3','HX45') = 0;
 512  fc.Fx('FAME','HX45','Reactor3')= 0;
 513  x.Fx('FAME','HX45','Reactor3') = 0;
 514   
 515   
 516   
 517   
 518   
 519  Positive variables
 520           Tmp_reactor          Temperature of reactor 4
 521           cat                  Catalyst ratio in input
 522           ratio_met_alk        Ratio of methanol to alkali
 523           Op                   Output
 524           conver               conversion rate;
 525   
 526   
 527   
 528  Tmp_reactor.lo = 45;
 529  Tmp_reactor.up = 65;
 530  Tmp_reactor.l = (Tmp_reactor.lo + Tmp_reactor.up)/2;
 531  cat.lo = 0.005;
 532  cat.up = 0.015;
 533  cat.l = (cat.lo + cat.up)/2;
 534  ratio_met_alk.lo = 4.5;
 535  ratio_met_alk.up = 7.5;
 536  ratio_met_alk.l = (ratio_met_alk.lo + ratio_met_alk.up)/2;
 537   
 538  *Src5 has only KOH as the input which is a variable
 539  *################################################*************
 540  *fc.up('KOH','Src5','Mix3') = 0.005827;
 541  *fc.lo('KOH','Src5','Mix3') = 0.001847;
 542  *################################################*************
 543  fc.up('KOH','Src5','Mix3') = 6;
 544  fc.lo('KOH','Src5','Mix3') = 0.01;
 545   
 546  fc.l('KOH','Src5','Mix3') = (fc.up('KOH','Src5','Mix3') + fc.lo('KOH','Src
      5','Mix3'))/2;
 547  *fc.L will be 0.5(min + max)
 548   
 549   
 550   
 551  ** Defininte scalars for Cost of different materials **
 552  Scalar
 553   
 554  *         Cost_FAME       Cost of biodiesel /1.4/
 555  *         Cost_Glycerol   Cost of glycerol /1.026/               (Old valu
      e is 0.6)
 556  *         Cost_PotPhos    Cost of potassium phosphate /3.491/       (Old v
      alue is 1.76)
 557  *         Cost_KOH        Cost of KOH /1.6/
 558  *         Cost_MeOH       Cost of Methanol /3.85/                        (
      Old value is 0.28)
 559  *         Cost_PhosA      Cost of Phosphoric acid /0.595/                 
      (Old value is 0.34)
 560  *         Cost_Steam      Cost of steam /0.02/
 561  *         Cost_Wa         Cost of process water /0.0004/                 (
      Old value if 0.0105)
 562  *         Cost_Oil        Cost of soybean oil /0.8147/                    
            (Old value is 0.682)
 563  *         Annual          Factor for converting Kg per s to kg per year /3
      1622400/
 564  *         Cost_tree       Restoration cost /196.34/
 565  *         Cost_land       Land cost       /3300/ ;
 566   
 567   
 568           Cost_FAME       Cost of biodiesel /1.4/
 569           Cost_Glycerol   Cost of glycerol /1.026/
 570           Cost_PotPhos    Cost of potassium phosphate /3.491/
 571           Cost_KOH        Cost of KOH /1.6/
 572           Cost_MeOH       Cost of Methanol /3.85/
 573           Cost_PhosA      Cost of Phosphoric acid /0.595/
 574           Cost_Steam      Cost of steam /0.02/
 575           Cost_Wa         Cost of process water /0.05/
 576           Cost_Oil        Cost of soybean oil /0.682/
 577           Annual          Factor for converting Kg per s to kg per year /31
      622400/
 578           Cost_tree       Restoration cost /196.34/
 579           Cost_land       Land cost       /3300/ ;
 580  *All costs are in $/kg. Check notes for references
 581  *Replace cost of water with (0.0105,0.021) for extreme case
 582   
 583   
 584   
 585   
 586  *         Rel_1, Rel_2;
 587   
 588   
 589  *Obj..    Z =E= Q('Hx1') + Q('Jet1') + Q('Hx4') + Q('Hx6') + Q('Hx7') + Q(
      'Hx8') + Q('Dry1') + Q_reb('BC1') + Q_reb('Rec1') + Q('Hx3');
 590   
 591   
 592  *Rel_1(J,unit,unit1)$Arc(unit,unit1)..
 593  *         fc(J,unit,unit1) =e= F(unit,unit1)*x(J,unit,unit1);
 594   
 595  *Rel_2(unit,unit1)$Arc(unit,unit1)..
 596  *         Sum(J,fc(J,unit,unit1)) =e= F(unit,unit1);
 597   
 598   
 599  Equations
 600           Feed_1, Feed_2, Admixing_1;
 601   
 602  Feed_1..
 603           fc('MeOH','Mix2','Mix3') =e= ratio_met_alk*(0.034826087)*fc('Oil'
      ,'Src','Mix3');
 604  *Calculating flow of methanol between the mix streams
 605  *MW('MeOH')/MW('Oil') = 0.034826087
 606   
 607  Feed_2..
 608           fc('MeOH','Col3','Mix2') =e= fc('MeOH','Mix2','Mix3') - fc('MeOH'
      ,'Src3','Mix2');
 609  *Calculating recycle stream flow
 610  Admixing_1(J)..
 611           fc(J,'Mix3','HX45') =e= fc(J,'Mix2','Mix3') + fc(J,'Src','Mix3') 
      + fc(J,'Src5','Mix3');
 612   
 613   
 614  *Reaction transesterification
 615  Equations
 616           Reactran_1, HX45_1, Yield, Convert, Reactran_2, Reactran_3, React
      ran_4, Reactran_5, Reactran_6, Reactran_7, Reactran_8, Reactran_9, React3_
      1,Reactran_10,
 617           Reactran_11;
 618   
 619   
 620  HX45_1..
 621           Q('HX45') =E= Sum(J,fc(J,'Mix3','HX45')*c_p_ind(J))*(T('HX45','Re
      actor3')-T('Mix3','HX45'));
 622  Reactran_1(J)..
 623           fc(J,'HX45','Reactor3') =E= fc(J,'Mix3','HX45');
 624   
 625  *Op refers to yield here
 626  Yield..
 627           Op =E= (74.6301 + (0.4209*Tmp_reactor) + (15.1582*cat) + (3.1561*
      ratio_met_alk)
 628           -(0.0019*T('HX45','Reactor3')*T('HX45','Reactor3')) - (0.2022*T('
      HX45','Reactor3')*cat)
 629           -(0.01925*T('HX45','Reactor3')*ratio_met_alk) - (4.0143*(cat)*(ca
      t))
 630           -(0.3400*cat*ratio_met_alk) - (0.1459*(ratio_met_alk)*(ratio_met_
      alk)));
 631   
 632  Convert..
 633           conver =E= Op*0.01;
 634   
 635   
 636  Reactran_2..
 637           fc('FAME','Reactor3','HX10') =E= fc('FAME','HX45','Reactor3')
 638           + 3*(0.317608696 )*conver*fc('Oil','HX45','Reactor3')
 639           + (1.04171123)*conver*fc('FFA','HX45','Reactor3');
 640   
 641  *MW('FAME')/MW('Oil') = 0.317608696
 642  *MW('FAME')/MW('FFA')= 1.04171123
 643   
 644   
 645  Reactran_3..
 646           fc('Oil','Reactor3','HX10') =E=(1-conver)*fc('Oil','HX45','Reacto
      r3');
 647   
 648   
 649  Reactran_4..
 650           fc('FFA','Reactor3','HX10') =E=(1-conver)*fc('FFA','HX45','Reacto
      r3');
 651   
 652  Reactran_5..
 653           fc('MeOH','Reactor3','HX10') =E= fc('MeOH','HX45','Reactor3')
 654           -(conver*fc('Oil','HX45','Reactor3'))*3*(0.034826087)
 655           -(conver*fc('FFA','HX45','Reactor3'))*(0.114224599);
 656  *MW('MeOH')/MW('Oil') = 0.034826087
 657  *MW('MeOH')/MW('FFA') = 0.114224599
 658   
 659   
 660   
 661   
 662  Reactran_6..
 663           fc('Glycerol','Reactor3','HX10') =E= conver*fc('Oil','HX45','Reac
      tor3')*(0.100101087);
 664  *MW('Glycerol')/MW('Oil') = 0.100101087
 665   
 666   
 667  Reactran_7..
 668           fc('Wa','Reactor3','HX10') =E= fc('Wa','HX45','Reactor3')
 669           + conver*fc('FFA','HX45','Reactor3')*(0.064224599);
 670  *MW('Wa')/MW('FFA') = 0.064224599
 671   
 672  Reactran_8..
 673           fc('KOH','Reactor3','HX10') =E= fc('KOH','HX45','Reactor3');
 674   
 675   
 676  Reactran_9..
 677           T('Reactor3','HX10') =E= T('HX45','Reactor3');
 678   
 679  React3_1..
 680           Q('Reactor3') =E= 469*(fc('FAME','Reactor3','HX10') - fc('FAME','
      HX45','Reactor3'));
 681   
 682  Reactran_10..
 683           fc('KOH','Mix2','Mix3') =L= 0.1;
 684  *         fc('KOH','Src5','Mix3') =E= Cat*fc('Oil','Src','Mix3')*0.01;
 685  Reactran_11..
 686          fc('Oil','Mix2','Mix3') =L= 0.4;
 687  *Reactran_12..
 688  *         fc('FFA','Mix2','Mix3') =L=0.1;
 689   
 690  *****************************
 691  *Methanol Distillation*
 692  *****************************
 693  Positive variables
 694           m_frac_c3(J,unit,unit1)    mol fraction of components in Column3
 695           recover_c3_MeOH            Recovery of methanol in column 3
 696           Reflux                     Intermediate: Reflux ratio in column 3
 697           R_Col3                     Reflux ratio in column 3
 698           P_Col3                     Pressure at feed tray in col3
 699           VpMeOH_1                   Vp of methanol in MD
 700           VpGlycerol_1               Vp of glycerol in MD
 701           VpKOH_1                    Vp of KOH in MD
 702           VpWa_1                     Vp of water in MD
 703           VpFAME_1                   Vp of FAME in MD
 704           P_Col3_Temp                Calculating pressure in col3
 705           Col3Mix2Temp               Temperature of stream Col3 to Mix2
 706           VpOil_1                    Vapor pressure of oil
 707           recover_c3_Wa              Recovery of water in col3
 708           recover_c3_FAME            Recovery of FAME in Col3
 709           recover_c3_Glycerol        Recovery of glycerol in Col3
 710           recover_c3_KOH             Recovery of KOH in col3
 711           recover_c3_Oil             Recovery of oil in col3
 712           recover_c3_FFA             Recovery of FFA in Col3
 713           R_Col3_Temp                Temp factor for R_Col3;
 714  Equations
 715           MD_1,MD_2,MD_3,MD_4,MD_5, MD_6, MD_7, MD_8,MD_9, MD_10, MD_11, MD
      _12, MD_13, MD_14, MD_15, MD_16, MD_17, MD_31, MD_32,MD_33,MD_34, MD_35, M
      D_36
 716           MD_18, MD_19, MD_20, MD_21, MD_23, MD_24, MD_25, MD_26 , HX11_1, 
      HX12_1, MD_27, MD_28, MD_29, MD_30,MD_37, MD_38;
 717  *Scalar
 718  *         dp              Pressure loss in column /0.1/
 719  *         alpha_c3        Relative volatility in column /4.5/;
 720   
 721   
 722  recover_c3_MeOH.lo = 0.94;
 723  recover_c3_MeOH.up = 0.99;
 724  recover_c3_MeOH.l = (recover_c3_MeOH.lo + recover_c3_MeOH.up)/2;
 725  P_Col3_Temp.lo = 0.01;
 726  recover_c3_Wa.lo = 0.75;
 727  recover_c3_Wa.up = 0.99;
 728  recover_c3_Wa.l = (recover_c3_Wa.lo + recover_c3_Wa.up)/2;
 729  recover_c3_FAME.lo = 0.01;
 730  recover_c3_FAME.up = 0.99;
 731  recover_c3_FAME.l = (recover_c3_FAME.up + recover_c3_FAME.lo)/2;
 732  recover_c3_Glycerol.lo = 0.75;
 733  recover_c3_Glycerol.up = 0.99;
 734  recover_c3_Glycerol.l = (recover_c3_Glycerol.lo + recover_c3_Glycerol.up)/
      2;
 735  recover_c3_KOH.lo = 0.75;
 736  recover_c3_KOH.up = 0.99;
 737  recover_c3_KOH.L = (recover_c3_KOH.lo + recover_c3_KOH.up)/2;
 738  recover_c3_Oil.lo = 0.75;
 739  recover_c3_Oil.up = 0.99;
 740  recover_c3_Oil.l = (recover_c3_Oil.lo + recover_c3_Oil.up)/2;
 741  recover_c3_FFA.lo = 0.01;
 742  recover_c3_FFA.up = 0.99;
 743  recover_c3_FFA.l = (recover_c3_FFA.lo  + recover_c3_FFA.up)/2;
 744   
 745   
 746  *for all components J in Wa,MeOH,Glycerol,KOH
 747  MD_1..
 748           fc('Wa','HX10','Col3') =E= fc('Wa','Reactor3','HX10');
 749  MD_2..
 750           fc('MeOH','HX10','Col3')=E= fc('MeOH','Reactor3','HX10');
 751  MD_3..
 752           fc('Glycerol','HX10','Col3')=E= fc('Glycerol','Reactor3','HX10');
 753  MD_4..
 754           fc('KOH','HX10','Col3')=E= fc('KOH','Reactor3','HX10');
 755  MD_5..
 756           fc('Oil','HX10','Col3')=E= fc('Oil','Reactor3','HX10');
 757   
 758  MD_6..
 759           fc('FAME','HX10','Col3')=E= fc('FAME','Reactor3','HX10');
 760   
 761  MD_38..
 762           fc('FFA','HX10','Col3') =E= fc('FFA','Reactor3','HX10');
 763   
 764   
 765  MD_7..
 766           F('HX10','Col3') =E=  fc('MeOH','HX10','Col3') + fc('Glycerol','H
      X10','Col3')
 767                                 + fc('KOH','HX10','Col3') + fc('Wa','HX10',
      'Col3') ;
 768   
 769   
 770   
 771  MD_8(J)$((ord(J) ne 8) and (ord(J) ne 9) and (ord(J) ne 5) and (ord(J) ne 
      6) and (ord(J) ne 7))..
 772           m_frac_c3(J,'HX10','Col3') =E= ((fc(J,'HX10','Col3')/F('HX10','Co
      l3')/MW(J)))
 773           /(((fc('MeOH','HX10','Col3')/F('HX10','Col3'))/MW('MeOH'))
 774           + ((fc('Glycerol','HX10','Col3')/F('HX10','Col3'))/MW('Glycerol')
      )
 775           + ((fc('KOH','HX10','Col3')/F('HX10','Col3'))/MW('KOH'))
 776           + ((fc('Wa','HX10','Col3')/F('HX10','Col3'))/MW('Wa')));
 777   
 778  *+ ((fc('Oil','HX10','Col3')/F('HX10','Col3'))/MW('Oil')));
 779   
 780   
 781   
 782  MD_9..
 783           VpFAME_1 =E=  (10**(coef_p('FAME','1')-(coef_p('FAME','2')/
 784           (coef_p('FAME','3')+T('HX10','Col3')+273))))*0.0075;
 785   
 786  *Conversion from Pa to mmHG
 787  MD_10..
 788           VpWa_1 =E= (10**(coef_p('Wa','1')-(coef_p('Wa','2')/
 789           (coef_p('Wa','3')+(T('HX10','Col3')+273)))))*750.06;
 790   
 791  *Conversion from Bar to mmHg
 792  MD_11..
 793           VpGlycerol_1 =E= 10**(coef_p('Glycerol','1')-(coef_p('Glycerol','
      2')/T('HX10','Col3')) -
 794             (coef_p('Glycerol','3')*log((T('HX10','Col3')+273))));
 795  *Torr and mmhg are almost equal
 796  *** NOTE ANTOINE EQUATION FOR OIL AND GLYCEROL ARE SLIGHTLY DIFF FROM THE 
      ORIGINAL EQUATION **
 797  MD_12..
 798           VpMeOH_1 =E= (10**(coef_p('MeOH','1')-(coef_p('MeOH','2')/
 799           (coef_p('MeOH','3')+(T('HX10','Col3')+273)))))*750.06;
 800  *Conversion from Bar to mmHg
 801   
 802   
 803  MD_13..
 804           VpKOH_1 =E= (10**(coef_p('KOH','1')-(coef_p('KOH','2')/
 805           (coef_p('KOH','3')+(T('HX10','Col3'))))));
 806   
 807  *T in C and Vp in mmHG
 808   
 809   
 810  MD_14..
 811           VpOil_1 =E= (exp(coef_p('Oil','1')+ (coef_p('Oil','2')/
 812           (coef_p('Oil','3')+(T('HX10','Col3')+273)))))*750.06;
 813   
 814  *** NOTE ANTOINE EQUATION FOR OIL AND GLYCEROL ARE SLIGHTLY DIFF FROM THE 
      ORIGINAL EQUATION **
 815  *Oil is in kPA, Temp is in K
 816  MD_15..
 817           P_Col3 =E= VpFAME_1
 818           + (m_frac_c3('Wa','HX10','Col3')*VpWa_1)
 819           + (m_frac_c3('MeOH','HX10','Col3')*VpMeOH_1)
 820           + (m_frac_c3('Glycerol','HX10','Col3')*VpGlycerol_1)
 821           + (m_frac_c3('KOH','HX10','Col3')*VpKOH_1);
 822  *+ (m_frac_c3('Oil','HX10','Col3')*VpOil_1);
 823   
 824  *         + (m_frac_c3('MeOH','HX10','Col3')*exp(coef_p('MeOH','1')-(coef_
      p('MeOH','2')/(coef_p('MeOH','3')+T('HX10','Col3')))))
 825  *         + (m_frac_c3('Glycerol','HX10','Col3')*exp(coef_p('Glycerol','1'
      )-(coef_p('Glycerol','2')/(coef_p('Glycerol','3')+T('HX10','Col3')))))
 826  *         + (m_frac_c3('KOH','HX10','Col3')*exp(coef_p('KOH','1')-(coef_p(
      'KOH','2')/(coef_p('KOH','3')+T('HX10','Col3')))));
 827   
 828   
 829  *P_Col3 in mmhg
 830   
 831   
 832  MD_16(J)..
 833          Q('HX10') =E= sum(h,fc(h,'HX10','Col3')*c_p_ind(h))*(T('HX10','Col
      3')-T('Reactor3','HX10'));
 834  *This has highest energy/heat consumption. Does not make any sense!
 835   
      This part is slighlty modified than the python code. In python, using flow
       of each individual components through
      reactros for the mass balance. In GAMS, using "J" of all components to do 
      mass balance, same as what is there in the supporting information
      Also, using recovery of MeOH alone since there is no recovery factor given
       for the rest of the components.
 841   
 842   
 843  MD_17..
 844           fc('Wa','Col3','HX13') =E= recover_c3_Wa*fc('Wa','HX10','Col3');
 845   
 846  MD_37..
 847           fc('MeOH','Col3','HX13') =E= (1-recover_c3_MeOH)*fc('MeOH','HX10'
      ,'Col3');
 848   
 849  MD_32..
 850           fc('Glycerol','Col3','HX13') =E= recover_c3_Glycerol*fc('Glycerol
      ','HX10','Col3');
 851   
 852  MD_33..
 853           fc('KOH','Col3','HX13') =E= recover_c3_KOH*fc('KOH','HX10','Col3'
      );
 854   
 855  MD_34..
 856           fc('Oil','Col3','HX13') =E= recover_c3_Oil*fc('Oil','HX10','Col3'
      );
 857   
 858  MD_35..
 859           fc('FFA','Col3','HX13') =E= recover_c3_FFA*fc('FFA','HX10','Col3'
      );
 860   
 861  MD_36..
 862           fc('FAME','Col3','HX13') =E= recover_c3_FAME*fc('FAME','HX10','Co
      l3');
 863   
 864   
 865  MD_18..
 866           fc('MeOH','Col3','Mix2') =E= recover_c3_MeOH*fc('MeOH','HX10','Co
      l3');
 867   
 868   
 869  MD_19..
 870           (P_Col3_Temp) =E= (1-0.5*dp)*P_Col3*0.0013332239;
 871   
 872  *P_Col3_Temp is mmhg. Convert to bar "x" b'Col3'y 0.0013332239 since coef 
      of MeOH are in bar and K
 873  MD_20..
 874                   (Col3Mix2Temp - 33.5)*(5.20409 - log10(P_Col3_Temp)) =E= 
      1581.341;
 875  *Col3Mix2Temp =E= (1581.341/(5.20409 - log10(P_Col3_Temp)))  -  (-33.50);
 876   
 877   
 878  MD_21..
 879           T('Col3','Mix2') =E= Col3Mix2Temp - 273;
 880   
 881   
 882  *Temp is in C
 883   
 884  *(coef_p('MeOH','2')/((coef_p('MeOH','1') -  log((1 - 0.5*dp)*P_Col3)))) -
       coef_p('MeOH','3');
 885  *log((1 - 0.5*dp)*P_Col3) =E= coef_p('MeOH','1') - ((coef_p('MeOH','2')/(c
      oef_p('MeOH','3') + T('Col3','Mix2'))));
 886  *T('Col3','Mix2') =e= -(coef_p('MeOH','3')) + (-coef_p('MeOH','2')/(log((1
      -(0.5*dp))*P_Col3)) - coef_p('MeOH','1'));
 887   
 888   
 889   
 890  MD_23..
 891           F('Col3','HX13') =E= fc('MeOH','Col3','HX13') + fc('Glycerol','Co
      l3','HX13') + fc('KOH','Col3','HX13') + fc('Wa','Col3','HX13')  ;
 892   
 893   
 894  MD_24(J)$((ord(J) ne 8) and (ord(J) ne 9) and (ord(J) ne 6) and (ord(J) ne
       5) and (ord(J) ne 7))..
 895           m_frac_c3(J,'Col3','HX13') =E= ((fc(J,'Col3','HX13')/F('Col3','HX
      13')/MW(J)))
 896           /(((fc('MeOH','Col3','HX13')/F('Col3','HX13'))/MW('MeOH'))
 897           + ((fc('Glycerol','Col3','HX13')/F('Col3','HX13'))/MW('Glycerol')
      )
 898           + ((fc('KOH','Col3','HX13')/F('Col3','HX13'))/MW('KOH'))
 899           + ((fc('Wa','Col3','HX13')/F('Col3','HX13'))/MW('Wa')));
 900   
 901  *+ ((fc('Oil','Col3','HX13')/F('Col3','HX13'))/MW('Oil'))
 902  *+ ((fc('FAME','Col3','HX13')/F('Col3','HX13'))/MW('FAME')));
 903   
 904   
 905   
 906  MD_25..
 907  *(J)$((ord(J) ne 8) and (ord(J) ne 9) and (ord(J) ne 1) and (ord(J) ne 6))
      ..
 908           P_Col3_Temp =E= (10**(coef_p('FAME','1')-coef_p('FAME','2')/
 909           (coef_p('FAME','3')+T('Col3','HX13'))))*0.0075
 910           + (m_frac_c3('MeOH','Col3','HX13')*(10**(coef_p('MeOH','1')-(coef
      _p('MeOH','2')/(coef_p('MeOH','3')+T('Col3','HX13')))))*750.06)
 911           + (m_frac_c3('KOH','Col3','HX13')*(10**(coef_p('KOH','1')-coef_p(
      'KOH','2')/(coef_p('KOH','3')+(T('Col3','HX13') + 273)))))
 912           + (m_frac_c3('Wa','Col3','HX13')*(10**(coef_p('Wa','1')-(coef_p('
      Wa','2')/(coef_p('Wa','3')+(T('Col3','HX13'))))))*750.06)
 913           + (m_frac_c3('Glycerol','Col3','HX13')*(10**(coef_p('Glycerol','1
      ')-(coef_p('Glycerol','2')/T('Col3','HX13')) - (coef_p('Glycerol','3')*log
      (T('Col3','HX13'))))));
 914   
 915   
 916  *** NOTE ANTOINE EQUATION FOR OIL AND GLYCEROL ARE SLIGHTLY DIFF FROM THE 
      ORIGINAL EQUATION **
 917   
 918   
 919  **** Check this line. Probably calculating summation this way may not be r
      ight ***
 920   
 921  MD_26..
 922           R_Col3 =E= 1.5*(1/(alpha_c3 - 1))*((0.9999/(m_frac_c3('MeOH','HX1
      0','Col3')+0.001))- (alpha_c3*((1-0.999)/(1-m_frac_c3('MeOH','HX10','Col3'
      )))));
 923   
 924  R_Col3.lo = 1;
 925  R_Col3.up = 3;
 926  R_Col3.l = (R_Col3.lo + R_Col3.up)/2;
 927   
 928   
 929  HX11_1..
 930           Q('HX11') =E= -fc('MeOH','Col3','Mix2')*(R_Col3 + 1)*dH_vap_0('Me
      OH');
 931  *Only methanol is recycled
 932   
 933  MD_27..
 934            x('Wa','Col3','HX13')*F('Col3','HX13') =E= fc('Wa','Col3','HX13'
      );
 935  *x('Wa','Col3','HX13') =E= fc('Wa','Col3','HX13')/F('Col3','HX13');
 936   
 937   
 938  MD_28..
 939             x('Glycerol','Col3','HX13')*F('Col3','HX13') =E= fc('Glycerol',
      'Col3','HX13');
 940  *x('Glycerol','Col3','HX13') =E= fc('Glycerol','Col3','HX13')/F('Col3','HX
      13');
 941   
 942  MD_29..
 943             x('MeOH','Col3','HX13')*F('Col3','HX13') =E= fc('MeOH','Col3','
      HX13');
 944  *x('MeOH','Col3','HX13') =E= fc('MeOH','Col3','HX13')/F('Col3','HX13');
 945   
 946  MD_30..
 947            x('FAME','Col3','HX13')*F('Col3','HX13') =E= fc( 'FAME','Col3','
      HX13');
 948  *x('FAME','Col3','HX13') =E= fc( 'FAME','Col3','HX13')/F('Col3','HX13');
 949   
 950  MD_31..
 951            x('Oil','Col3','HX13')*F('Col3','HX13') =E= fc('Oil','Col3','HX1
      3');
 952  *x('Oil','Col3','HX13') =E= fc('Oil','Col3','HX13')/F('Col3','HX13');
 953   
 954   
 955  HX12_1..
 956           Q('HX12') =E= F('Col3','HX13')*(R_Col3 + 1)*((x('Wa','Col3','HX13
      ')*dH_vap_0('Wa')) +
 957                 (x('Glycerol','Col3','HX13')*dH_vap_0('Glycerol')) +
 958                 (x('MeOH','Col3','HX13')*dH_vap_0('MeOH')) +
 959                 (x('FAME','Col3','HX13')*dH_vap_0('FAME')) +
 960                 (x('Oil','Col3','HX13')*dH_vap_0('Oil')));
 961   
 962  *****************************
 963  ********** WASHING **********
 964  *****************************
 965  *Src6 has water as input which is a variable
 966  **##################################################****
 967  *fc.lo('Wa','Src6','Sep2') = 0.01;
 968  *fc.up('Wa','Src6','Sep2') = 10;
 969  **##################################################****
 970  *fc.lo('Wa','SrcWa','Src6') = 0.01;
 971  *fc.up('Wa','SrcWa','Src6') = 10;
 972   
 973  *fc.l('Wa','SrcWa','Src6') = (fc.lo('Wa','SrcWa','Src6') + fc.up('Wa','Src
      Wa','Src6'))/2;
 974  *fc.L
 975   
 976   
 977  Positive variable
 978           water_req      Water input required;
 979   
 980   
 981  Equations
 982           Wash_1, Wash_2, HX13_1 ,Wash_3, Wash_4, Wash_5, Wash_6, Wash_7, W
      ash_8, Wash_9, Wash_10, Wash_11, Wash_12, Wash_14, Wash_15, Wash_16, Wash_
      17, Wash_18, Wash_19
 983           Wash_20, Wash_21, Wash_22, Wash_23, Wash_13,Wash_25, Wash_26 ;
 984   
 985  Wash_1..
 986           fc('Wa','HX13','Sep2') =E= fc('Wa','Col3','HX13');
 987  Wash_2..
 988           fc('MeOH','HX13','Sep2') =E= fc('MeOH','Col3','HX13');
 989  Wash_3..
 990           fc('Glycerol','HX13','Sep2') =E= fc('Glycerol','Col3','HX13');
 991  Wash_4..
 992           fc('KOH','HX13','Sep2') =E= fc('KOH','Col3','HX13');
 993  Wash_5..
 994           fc('Oil','HX13','Sep2') =E= fc('Oil','Col3','HX13');
 995  Wash_6..
 996           fc('FAME','HX13','Sep2') =E= fc('FAME','Col3','HX13');
 997  Wash_7..
 998           fc('FFA','HX13','Sep2') =E= fc('FFA','Col3','HX13');
 999  Wash_9..
1000           F('HX13','Sep2') =E= fc('Wa','Col3','HX13') + fc('MeOH','Col3','H
      X13')+ fc('Glycerol','Col3','HX13')+ fc('KOH','Col3','HX13')+ fc('Oil','Co
      l3','HX13')+
1001           fc('FAME','Col3','HX13') + fc('FFA','Col3','HX13');
1002   
1003  **** THIS LINE IS NOT WORKING. NOT ABLE TO ASSIGN A VARIABLE TP FC.UP. CHE
      CK HOW THIS CAN BE FIXED *****
1004  *Value of F('HX13','Sep2') is 21.15 so fix water input max as 10
1005  *fc.UP('Wa','Src6','Sep2') = 0.01*F.l('HX13','Sep2');
1006   
1007  Wash_8..
1008           water_req =E= 0.01*F('HX13','Sep2');
1009  *Water input is 1% of total biodiesel phase.
1010  Wash_26..
1011           fc('Wa','Src6','Sep2') =E= water_req;
1012   
1013  HX13_1..
1014           Q('HX13') =E=(fc('Wa','Col3','HX13')*c_p_ind('Wa') + fc('MeOH','C
      ol3','HX13')*c_p_ind('MeOH') +
1015                        fc('Glycerol','Col3','HX13')*c_p_ind('Glycerol') + f
      c('KOH','Col3','HX13')*c_p_ind('KOH') +
1016           fc('FAME','Col3','HX13')*c_p_ind('FAME') + fc('FFA','Col3','HX13'
      )*c_p_ind('FFA') + fc('Oil','Col3','HX13')*c_p_ind('Oil'))*(T('HX13','Sep2
      ')-(T('Col3','HX13')));
1017   
1018  Wash_10..
1019           T('Sep2','HX19') =E= T('Sep2','Reactor4');
1020   
1021  Wash_11..
1022           fc('Wa','Sep2','Reactor4') =E= Separation('Wa')*(fc('Wa','HX13','
      Sep2') +fc('Wa','Src6','Sep2'));
1023  Wash_12..
1024           fc('MeOH','Sep2','Reactor4') =E= Separation('MeOH')*(fc('MeOH','H
      X13','Sep2') + fc('MeOH','Src6','Sep2'));
1025  Wash_13..
1026           fc('Glycerol','Sep2','Reactor4') =E= Separation('Glycerol')*(fc('
      Glycerol','HX13','Sep2') + fc('Glycerol','Src6','Sep2'));
1027  Wash_14..
1028           fc('KOH','Sep2','Reactor4') =E= Separation('KOH')*(fc('KOH','HX13
      ','Sep2') + fc('KOH','Src6','Sep2'));
1029  Wash_25..
1030           fc('Oil','Sep2','Reactor4') =E= Separation('Oil')*(fc('Oil','HX13
      ','Sep2') + fc('Oil','Src6','Sep2'));
1031  Wash_15..
1032           fc('FAME','Sep2','Reactor4') =E= Separation('FAME')*(fc('FAME','H
      X13','Sep2') + fc('FAME','Src6','Sep2'));
1033  Wash_16..
1034           fc('FFA','Sep2','Reactor4') =E= Separation('FFA')*(fc('FFA','HX13
      ','Sep2') + fc('FFA','Src6','Sep2'));
1035  Wash_17..
1036           fc('Wa','Sep2','HX19') =E= (1-Separation('Wa'))*(fc('Wa','HX13','
      Sep2') +fc('Wa','Src6','Sep2'));
1037  Wash_18..
1038           fc('MeOH','Sep2','HX19') =E= (1-Separation('MeOH'))*(fc('MeOH','H
      X13','Sep2') + fc('MeOH','Src6','Sep2'));
1039  Wash_19..
1040           fc('Glycerol','Sep2','HX19') =E= (1-Separation('Glycerol'))*(fc('
      Glycerol','HX13','Sep2') + fc('Glycerol','Src6','Sep2'));
1041  Wash_20..
1042           fc('KOH','Sep2','HX19') =E= (1-Separation('KOH'))*(fc('KOH','HX13
      ','Sep2') + fc('KOH','Src6','Sep2'));
1043  Wash_21..
1044           fc('Oil','Sep2','HX19') =E= (1-Separation('Oil'))*(fc('Oil','HX13
      ','Sep2') + fc('Oil','Src6','Sep2'));
1045  Wash_22..
1046           fc('FAME','Sep2','HX19') =E= (1-Separation('FAME'))*(fc('FAME','H
      X13','Sep2') + fc('FAME','Src6','Sep2'));
1047  Wash_23..
1048           fc('FFA','Sep2','HX19') =E= (1-Separation('FFA'))*(fc('FFA','HX13
      ','Sep2') + fc('FFA','Src6','Sep2'));
1049   
1050  *******************************
1051  ** Neutralization Alkali reaction **
1052  *******************************
1053   
1054  Equations
1055           Neualk_1, Neualk_2, Neualk_3, Neualk_4, Neualk_5, Reactor4_1,  Ne
      ualk_6,  Neualk_7,  Neualk_8,  Neualk_9,  Neualk_10;
1056   
1057  Neualk_1..
1058           fc('MeOH','Reactor4','HX14') =E= fc('MeOH','Sep2','Reactor4');
1059  Neualk_6..
1060           fc('Glycerol','Reactor4','HX14') =E= fc('Glycerol','Sep2','Reacto
      r4');
1061  Neualk_7..
1062           fc('Oil','Reactor4','HX14') =E= fc('Oil','Sep2','Reactor4');
1063  Neualk_8..
1064           fc('FFA','Reactor4','HX14') =E= fc('FFA','Sep2','Reactor4');
1065  Neualk_9..
1066           fc('FAME','Reactor4','HX14') =E= fc('FAME','Sep2','Reactor4');
1067  Neualk_10..
1068           fc('PhosA','Reactor4','HX14') =E= fc('PhosA','Sep2','Reactor4');
1069   
1070  Neualk_2..
1071           fc('PhosA','Src7','Reactor4') =E= 0.333*fc('KOH','Sep2','Reactor4
      ')*(1.746706211);
1072  *MW('PhosA')/MW('KOH') = 1.746706211
1073  Neualk_3..
1074           fc('PotPhos','Reactor4','Snk3') =E= 0.333*fc('KOH','Sep2','Reacto
      r4')*(3.104502937);
1075  *MW('PotPhos')/MW('KOH')  =3.104502937
1076  Neualk_4..
1077           fc('Wa','Reactor4','HX14') =E= fc('Wa','Sep2','Reactor4') + fc('K
      OH','Sep2','Reactor4')*(0.321090943);
1078  *MW('Wa')/MW('KOH') =     0.321090943
1079   
1080  Reactor4_1..
1081           Q('Reactor4') =E= (fc('PhosA','Src7','Reactor4')/MW('PhosA'))*dhr
      eactneu;
1082   
1083  Neualk_5(J)$((ord(J) eq 1) and (ord(J)eq 2) and (ord(J)eq 3) and (ord(J)eq
       4) and (ord(J)eq 8) and (ord(J)eq 9))..
1084           Q('Reactor4') =E= sum(h,fc(h,'Reactor4','HX14')*c_p_ind(h))*(T('R
      eactor4','HX14')-(T('Sep2','Reactor4')));
1085  *Wa, MeOH, Gly, KOH, PhosA, PotPhoS
1086  *Solve for T('Reactor4','HX14')
1087   
1088   
1089  *******************************
1090  *** FAME DISTILLATION ********
1091  ***************************
1092  Positive variables
1093           m_frac_c5       Fraction of components in column 5
1094           VpOil_2         Vapor pressure of oil in Col 5
1095           VpFAME_2        Vapor pressure of FAME in Col 5
1096           VpFFA_2         Vapor pressure of FFA in Col 5
1097           P_Col5          Pressure in Col5
1098           Col5HX22Temp    Distillate temperature_temp var
1099           P_Col5_Temp_1   Distillate Pressure in Col5
1100           recover_oil     Oil recovery in FAME distaillation
1101           recover_FAME    FAME recovery in distillation column
1102           P_Col5_Temp_2   Reboiler pressure in Col5
1103           Col5HX23Temp    Bubble point temperature_temp var
1104           R_Col5          Reflux ratio in distillation;
1105   
1106   
1107  recover_oil.lo = 0.5;
1108  recover_oil.up = 0.997;
1109  recover_oil.l = (recover_oil.lo + recover_oil.up)/2;
1110  recover_FAME.lo = 0.5;
1111  recover_FAME.up = 0.997;
1112  recover_FAME.l = (recover_FAME.lo + recover_FAME.up)/2;
1113  P_Col5_Temp_1.lo = 0.01;
1114  P_Col5_Temp_2.lo = 0.01;
1115   
1116  *** This is another variable in the design problem ***
1117  R_Col5.lo = 2;
1118  R_Col5.up = 3;
1119  R_Col5.l = (R_Col5.lo + R_Col5.up)/2;
1120   
1121  Equations
1122           FAME_1, FAME_2, FAME_3, HX19_1, FAME_4, FAME_5, FAME_6, FAME_7, F
      AME_8, FAME_9,FAME_10, FAME_11, FAME_12, FAME_13, FAME_14, FAME_15, FAME_1
      6, FAME_17,
1123           FAME_18, FAME_19, FAME_21, FAME_22, HX20_1, HX21_1, HX23_1, HX22_
      1, FAME_23;
1124   
1125   
1126  FAME_1..
1127           fc('Oil','HX19','Col5') =E= fc('Oil','Sep2','HX19');
1128   
1129  FAME_2..
1130           fc('FAME','HX19','Col5') =E= fc('FAME','Sep2','HX19');
1131   
1132  FAME_3..
1133           fc('FFA','HX19','Col5') =E= fc('FFA','Sep2','HX19');
1134   
1135  HX19_1(J)$((ord(J) eq 5) and (ord(J)eq 6) and (ord(J)eq 7))..
1136           Q('HX19') =E= sum(h,fc(h,'HX19','Col5')*c_p_ind(h))*(T('HX19','Co
      l5')-(T('Sep2','HX19')));
1137   
1138   
1139  FAME_4..
1140           F('HX19','Col5') =E=  fc('Oil','HX19','Col5') + fc('FAME','HX19',
      'Col5') +  fc('FFA','HX19','Col5');
1141   
1142   
1143  FAME_5(J)$((ord(J) eq 5) and (ord(J) eq 6) and (ord(J) eq 7))..
1144           m_frac_c5(J,'HX19','Col5') =E= ((fc(J,'HX19','Col5')/F('HX19','Co
      l5')/MW(J)))
1145           /(((fc('Oil','HX19','Col5')/F('HX19','Col5'))/MW('Oil'))
1146           + ((fc('FAME','HX19','Col5')/F('HX19','Col5'))/MW('FAME'))
1147           + ((fc('FFA','HX10','Col5')/F('HX19','Col5'))/MW('FFA')));
1148   
1149  FAME_6..
1150           VpOil_2 =E= (exp(coef_p('Oil','1')+ (coef_p('Oil','2')/
1151           (coef_p('Oil','3')+(T('HX19','Col5')+273)))))*0.7506;
1152   
1153   
1154  *Vp in kPa is converted to mmhg, Temp in C is converted to K
1155   
1156  FAME_7..
1157           VpFAME_2 =E=  (10**(coef_p('FAME','1')-(coef_p('FAME','2')/
1158           (coef_p('FAME','3')+T('HX19','Col5')+273))))*0.0075;
1159   
1160  *Conversion from Pa to mmHG
1161   
1162  FAME_8..
1163           VpFFA_2 =E= (10**(coef_p('FFA','1')-(coef_p('FFA','2')/
1164           (coef_p('FFA','3')+(T('HX19','Col5')+273)))))*750.06;
1165  *Conversion from Bar to mmhg
1166   
1167  FAME_9..
1168           P_Col5 =E= (m_frac_c5('Oil','HX19','Col5')*VpOil_2) + (m_frac_c5(
      'FAME','HX19','Col5')*VpFAME_2)
1169                   + (m_frac_c5('FFA','HX19','Col5')*VpFFA_2);
1170   
1171  FAME_10..
1172           fc('FAME','Col5','HX22') =E= recover_FAME*fc('FAME','HX19','Col5'
      );
1173  FAME_11..
1174           fc('FFA','Col5','HX22') =E= fc('FFA','HX19','Col5');
1175   
1176   
1177  FAME_12..
1178           fc('Oil','Col5','HX22') =E= (1-recover_oil)*fc('Oil','HX19','Col5
      ');
1179   
1180   
1181  FAME_13..
1182           fc('FAME','Col5','HX23') =E= (1-recover_FAME)*fc('FAME','HX19','C
      ol5');
1183   
1184   
1185  FAME_14..
1186           fc('Oil','Col5','HX23') =E= (recover_Oil)*fc('Oil','HX19','Col5')
      ;
1187   
1188  FAME_15..
1189   
1190           P_Col5_Temp_1 =E= (1-0.5*dp)*P_Col5*133.322365;
1191  *Pressure from mmHG to Pa since FAME is PA
1192   
1193  FAME_16..
1194           Col5HX22Temp =E= (1450.62/(8.2175 - log10(P_Col5_Temp_1)))  -  (8
      8.03);
1195   
1196  *Temp is in K
1197  FAME_17..
1198           T('Col5','HX22') =E= Col5HX22Temp - 273;
1199   
1200   
1201  FAME_18..
1202           P_Col5_Temp_2 =E= (1+0.5*dp)*P_Col5*0.133322365;
1203   
1204   
1205  *FAME_24..
1206  *         fc('PotPhos','Reactor4','Snk3') =L= 0.532;
1207  *Constraint that PotPhos production should be less than 0.532.
1208   
1209  FAME_19..
1210          T('Col5','HX23')  =E= (-(-167.48) - (-708.72/(log(P_Col5_Temp_2) -
       11.4785)));
1211   
1212  *Pressure is in mmHg converted to kPa since VP of oil is in KPA
1213  *Converting Temp from K to C
1214   
1215  FAME_21..
1216           F('Col5','HX22') =E= fc('Oil','Col5','HX22') + fc('FAME','Col5','
      HX22') + fc('FFA','Col5','HX22');
1217   
1218  FAME_22..
1219           F('Col5','HX23') =E= fc('Oil','Col5','HX23') + fc('FAME','Col5','
      HX23') + fc('FFA','Col5','HX23');
1220   
1221  HX20_1..
1222           Q('HX20') =E= -F('Col5','HX22')*(R_Col5 + 1)*dH_vap_0('FAME');
1223   
1224  HX21_1..
1225           Q('HX21') =E= F('Col5','HX23')*(R_Col5 + 1)*dH_vap_0('Oil');
1226   
1227   
1228   
1229  HX22_1(J)$((ord(J) eq 5) and (ord(J)eq 6) and (ord(J)eq 7))..
1230           Q('HX22') =E= (fc('Oil','Col5','HX22')*c_p_ind('Oil') + fc('FFA',
      'Col5','HX22')*c_p_ind('FFA')+ fc('FAME','Col5','HX22')*c_p_ind('FAME'))*(
      T_amb-T('Col5','HX22'));
1231   
1232  HX23_1(J)$((ord(J) eq 5) and (ord(J)eq 6) and (ord(J)eq 7))..
1233           Q('HX23') =E=(fc('Oil','Col5','HX22')*c_p_ind('Oil') + fc('FFA','
      Col5','HX22')*c_p_ind('FFA')+ fc('FAME','Col5','HX22')*c_p_ind('FAME'))*(T
      _amb-(T('Col5','HX23')));
1234   
1235   
1236   
1237  *******************************
1238  **** Glcyerol Distillation *****
1239  *********************************
1240   
1241  Equations
1242           Glydis_1, Glydis_2, Glydis_3, HX14_1, Glydis_4, Glydis_5, Glydis_
      6, Glydis_7, Glydis_8, Glydis_9, Glydis_10, Glydis_11, Glydis_12, Glydis_1
      3,Glydis_14,
1243            Glydis_15, Glydis_16, Glydis_17, Glydis_18, Glydis_19 , Glydis_2
      0, Glydis_21, Glydis_22, Glydis_23, Glydis_24, Glydis_25, Glydis_26, HX15_
      1, HX16_1
1244           HX17_1, HX18_1, Glydis_27, Glydis_28;
1245   
1246  Positive variables
1247           m_frac_c4       Fraction of components in column 4
1248           P_Col4          Pressure in Dis col 4
1249           VpWa_3          Vapor pressure of water
1250           VpGly_3         Vapor pressure of glycerol
1251           VpMeOH_3        Vapor preesure of MeOH
1252           recover_c4_wa   Water recovery in col4
1253           x_gly           purity of glycerol
1254           VpWa_4          Vp of water in col4
1255           VpMeOH_4        Vp of methanol in col4
1256           VpGly_4         Vp of glyercol in col4
1257           Col4HX17Temp    Temp in Col4
1258           P_Col4_Temp_1   Distillate pressure in col 4
1259           P_Col4_Temp_2   Reboiler pressure in Col 4
1260           Col4HX18Temp    Temp in HX18Col4 stream
1261           R_Col4          Reflux ratio in Column 4;
1262   
1263  **** This is another variable in the problem ****
1264  recover_c4_wa.lo = 0.5;
1265  recover_c4_wa.up = 0.9;
1266  recover_c4_wa.l = (recover_c4_wa.lo + recover_c4_wa.up)/2;
1267   
1268  *recover_c4_wa.l  = (recover_c4_wa.lo + recover_c4_wa.up)/2;
1269  ** This value is given **
1270   
1271  *Giving some lower bounds to avoid division by zero *
1272  P_Col4_Temp_1.lo = 0.01;
1273  P_Col4_Temp_2.lo = 0.01;
1274  P_Col4.lo = 0.01;
1275  Col4HX17Temp.lo = 0.01;
1276  Col4HX18Temp.lo = 0.01;
1277   
1278   
1279   
1280   
1281  Glydis_1..
1282           fc('Wa','HX14','Col4') =E= fc('Wa','Reactor4','HX14');
1283  Glydis_2..
1284           fc('MeOH','HX14','Col4') =E= fc('MeOH','Reactor4','HX14') ;
1285  Glydis_3..
1286           fc('Glycerol','HX14','Col4') =E= fc('Glycerol','Reactor4','HX14')
       ;
1287   
1288  HX14_1(J)$((ord(J) eq 1) and (ord(J) eq 2) and (ord(J) eq 3))..
1289           Q('HX14') =E=sum(h,fc(h,'HX14','Col4')*c_p_ind(h))*(T('HX14','Col
      4')-T('Reactor4','HX14'));
1290   
1291   
1292  Glydis_4..
1293           F('HX14','Col4') =E= fc('Wa','HX14','Col4') + fc('MeOH','HX14','C
      ol4') + fc('Glycerol','HX14','Col4');
1294   
1295  Glydis_5(J)$((ord(J) eq 1) and (ord(J) eq 2) and (ord(J) eq 3))..
1296           m_frac_c4(J,'HX14','Col4') =E= ((fc(J,'HX14','Col4')/F('HX14','Co
      l4')/MW(J)))
1297           /(((fc('Wa','HX14','Col4')/F('HX14','Col4'))/MW('Wa'))
1298           + ((fc('MeOH','HX14','Col4')/F('HX14','Col4'))/MW('MeOH'))
1299           + ((fc('Glycerol','HX14','Col4')/F('HX14','Col4'))/MW('Glycerol')
      ));
1300   
1301   
1302  Glydis_6..
1303           VpWa_3 =E= (10**(coef_p('Wa','1')-(coef_p('Wa','2')/
1304           (coef_p('Wa','3')+(T('HX14','Col4')+273)))))*750.06;
1305   
1306  *Conversion from Bar to mmHg, converting temp from C to K
1307   
1308  Glydis_7..
1309            VpGly_3 =E= 10**(coef_p('Glycerol','1')-(coef_p('Glycerol','2')/
      T('HX14','Col4')) -
1310             (coef_p('Glycerol','3')*log((T('HX14','Col4')+273))));
1311  *Torr and mmhg are almost equal
1312  *** NOTE ANTOINE EQUATION FOR OIL AND GLYCEROL ARE SLIGHTLY DIFF FROM THE 
      ORIGINAL EQUATION **
1313   
1314  Glydis_8..
1315            VpMeOH_3 =E= (10**(coef_p('MeOH','1')-(coef_p('MeOH','2')/
1316           (coef_p('MeOH','3')+(T('HX14','Col4')+273)))))*750.06;
1317  *Conversion from Bar to mmHg
1318   
1319   
1320  Glydis_9..
1321            P_Col4 =E= (m_frac_c4('Wa','HX14','Col4')*VpWa_3) + (m_frac_c4('
      MeOH','HX14','Col4')*VpMeOH_3) + (m_frac_c4('Gly','HX14','Col4')*VpGly_3);
1322   
1323  *P in mmHg
1324   
1325  Glydis_10..
1326           fc('MeOH','Col4','HX17') =E= fc('MeOH','HX14','Col4');
1327   
1328  Glydis_11..
1329           fc('Glycerol','Col4','HX18') =E= fc('Glycerol','HX14','Col4');
1330   
1331  Glydis_12..
1332           fc('Wa','Col4','HX17') =E= recover_c4_wa*fc('Wa','HX14','Col4');
1333   
1334   
1335  Glydis_13..
1336           fc('Wa','Col4','HX18') =E= (1-recover_c4_wa)*fc('Wa','HX14','Col4
      ');
1337   
1338  Glydis_14..
1339           F('Col4','HX18') =E= fc('Wa','Col4','HX18') + fc('MeOH','Col4','H
      X18') + fc('Glycerol','Col4','HX18');
1340   
1341  Glydis_15..
1342           x_gly =E= fc('Glycerol','Col4','HX18')/F('Col4','HX18');
1343  Glydis_27..
1344           x_gly =G= 0.92;
1345   
1346  Glydis_16..
1347           F('Col4','HX17') =E= fc('Wa','Col4','HX17')+ fc('MeOH','Col4','HX
      17') + fc('Glycerol','Col4','HX17');
1348   
1349   
1350  Glydis_17(J)$((ord(J) eq 1) and (ord(J) eq 2) and (ord(J) eq 3))..
1351           m_frac_c4(J,'Col4','HX17') =E= ((fc(J,'Col4','HX17')/F('Col4','HX
      17')/MW(J)))
1352           /(((fc('Wa','Col4','HX17')/F('Col4','HX17'))/MW('Wa'))
1353           + ((fc('MeOH','Col4','HX17')/F('Col4','HX17'))/MW('MeOH'))
1354           + ((fc('Glycerol','Col4','HX17')/F('Col4','HX17'))/MW('Glycerol')
      ));
1355   
1356  Glydis_18..
1357           P_Col4_Temp_1 =E= (1-0.5*dp)*P_Col4;
1358   
1359   
1360   
1361  Glydis_19..
1362           P_Col4_Temp_1 =E= (m_frac_c4('Wa','Col4','HX17')*((10**(coef_p('W
      a','1')-(coef_p('Wa','2')/
1363           (coef_p('Wa','3')+(Col4HX17Temp+273)))))*750.06))   +
1364           (m_frac_c4('Glycerol','Col4','HX17')*10**(coef_p('Glycerol','1')-
      (coef_p('Glycerol','2')/Col4HX17Temp+273) -
1365             (coef_p('Glycerol','3')*log((Col4HX17Temp+273))))) +
1366           (m_frac_c4('MeOH','Col4','HX17')*((10**(coef_p('MeOH','1')-(coef_
      p('MeOH','2')/
1367           (coef_p('MeOH','3')+(Col4HX17Temp+273)))))*750.06));
1368   
1369   
1370  Glydis_20..
1371           T('Col4','HX17') =E= Col4HX17Temp - 273;
1372   
1373   
1374   
1375  Glydis_21(J)$((ord(J) eq 1) and (ord(J) eq 2) and (ord(J) eq 3))..
1376           m_frac_c4(J,'Col4','HX18') =E= ((fc(J,'Col4','HX18')/F('Col4','HX
      18')/MW(J)))
1377           /(((fc('Wa','Col4','HX18')/F('Col4','HX18'))/MW('Wa'))
1378           + ((fc('MeOH','Col4','HX18')/F('Col4','HX18'))/MW('MeOH'))
1379           + ((fc('Glycerol','Col4','HX18')/F('Col4','HX18'))/MW('Glycerol')
      ));
1380   
1381   
1382  Glydis_22..
1383             P_Col4_Temp_2 =E= (1+0.5*dp)*P_Col4;
1384   
1385   
1386  Glydis_23..
1387            P_Col4_Temp_2 =E= (m_frac_c4('Wa','Col4','HX18')*(10**(coef_p('W
      a','1')-(coef_p('Wa','2')/
1388           (coef_p('Wa','3')+(Col4HX18Temp+273)))))*750.06)   +
1389           (m_frac_c4('Glycerol','Col4','HX18')*10**(coef_p('Glycerol','1')-
      (coef_p('Glycerol','2')/Col4HX18Temp + 273) -
1390             (coef_p('Glycerol','3')*log((Col4HX18Temp+273))))) +
1391           (m_frac_c4('MeOH','Col4','HX18')*(10**(coef_p('MeOH','1')-(coef_p
      ('MeOH','2')/
1392           (coef_p('MeOH','3')+(Col4HX18Temp+273)))))*750.06);
1393   
1394   
1395  Glydis_24..
1396           T('Col4','HX18') =E=   Col4HX18Temp - 273;
1397   
1398   
1399  **This is a constraint given in the problem **
1400  Glydis_25..
1401   
1402           T('Col4','HX18') =l= 150;
1403  *In degree C
1404   
1405  *Heat balance to condenser and reboiler
1406  Glydis_26..
1407           R_Col4 =E= 1.5*(1/(alpha_c4 - 1))*((0.9999/(m_frac_c4('MeOH','HX1
      4','Col4')+0.001))- (alpha_c4*((1-0.999)/(1-m_frac_c4('MeOH','HX14','Col4'
      )))));
1408   
1409   
1410  Glydis_28..
1411       fc('Glycerol','Col4','HX17') =L= 0.003;
1412   
1413   
1414   
1415  R_Col4.lo = 0.75;
1416  R_Col4.up = 3;
1417  R_Col4.l = (R_Col4.up + R_Col4.lo)/2;
1418   
1419  HX15_1..
1420           Q('HX15') =E= -F('Col4','HX17')*(R_Col4 + 1)*(((fc('Wa','Col4','H
      X17')/F('Col4','HX17'))*dH_Vap_0('Wa')) +
1421                   ((fc('Glycerol','Col4','HX17')/F('Col4','HX17'))*dH_Vap_0
      ('Glycerol')) +
1422                   ((fc('MeOH','Col4','HX17')/F('Col4','HX17'))*dH_Vap_0('Me
      OH')));
1423  HX16_1..
1424           Q('HX16') =E= F('Col4','HX18')*(R_Col4+1)*(((fc('Wa','Col4','HX18
      ')/F('Col4','HX18'))*dH_Vap_0('Wa')) +
1425                   ((fc('Glycerol','Col4','HX18')/F('Col4','HX18'))*dH_Vap_0
      ('Glycerol')) +
1426                   ((fc('MeOH','Col4','HX18')/F('Col4','HX18'))*dH_Vap_0('Me
      OH')));
1427   
1428  HX17_1..
1429           Q('HX17') =E= (fc('Wa','Col4','HX17')*c_p_ind('Wa') + fc('Glycero
      l','Col4','HX17')*c_p_ind('Glycerol') + fc('MeOH','Col4','HX17')*c_p_ind('
      MeOH'))*(T_amb-T('Col4','HX17'));
1430   
1431   
1432  HX18_1..
1433           Q('HX18') =E= (fc('Wa','Col4','HX17')*c_p_ind('Wa') + fc('Glycero
      l','Col4','HX17')*c_p_ind('Glycerol') + fc('MeOH','Col4','HX17')*c_p_ind('
      MeOH'))*(T_amb-(T('Col4','HX18')));
1434   
1435   
1436   
1437  **Calculating heat requirements ****
1438  Variables
1439           Z       Objective function variables
1440           QS_Max  Heat required in process;
1441   
1442   
1443  Equations
1444           Heatreq1;
1445  *, Heatreq2, Heatreq3, Heatreq4, Heatreq5, Heatreq6, Heatreq7, Heatreq8;
1446  *Heatreq1..
1447  *         QS_Max =G= Q('HX45');
1448  *Heatreq2..
1449  *         QS_Max =G= Q('HX10');
1450  *Heatreq3..
1451  *         QS_Max =G= Q('HX12');
1452  *Heatreq4..
1453  *         QS_Max =G= Q('HX14');
1454  *Heatreq5..
1455  *         QS_Max =G= Q('HX16');
1456  *Heatreq6..
1457  *         QS_Max =G= Q('HX19');
1458  *Heatreq7..
1459  *         QS_Max =G= Q('Reactor3');
1460  *Heatreq8..
1461  *         QS_Max =G= Q('HX21');
1462   
1463  Heatreq1..
1464                   QS_Max =E=  Q('HX12') + Q('Reactor3') + Q('HX45') + Q('HX
      10') +  Q('HX16') +  Q('HX21');
1465  *QS_Max =E=  Q('HX12') + Q('Reactor3') + Q('HX45');
1466   
1467   
1468   
1469  *********************Electricity Consumed in the Biodiesel Plant**********
      *******************
1470  EQUATIONS elec_cons;
1471  Variable Elec_Consumed;
1472   
1473  elec_cons.. Elec_Consumed=E=fc('FAME','Col5','HX22')*0.0502*3600;
1474   
1475   
1476   
1477  ***The NG and Coal consumption code****
1478   
1479   
1480  *This are the variables that determine the decision of coal and NG selecti
      on.
1481  positive variable x1,x2,x3;
1482  x1.up = 1;
1483  x2.up = 1;
1484  x3.up = 1;
1485   
1486  x1.L = 0;
1487  x2.L = 1;
1488  x3.L = 0;
1489   
1490  equation choice1 ;
1491  choice1.. x1+x2+x3 =E= 1;
1492   
1493   
      parameter
      Cost_coal /0.0423/
      Cost_NG  /0.297/
1499   
1500   
1501  parameters
1502  *Units KJ/kg
1503  coal_energy /27000/
1504  *Units KJ/m3
1505  NG_energy /35000/;
1506   
1507   
1508   
1509  variable coal1,coal2, NG;
1510   
1511  Equations fuel1,fuel2,fuel3;
1512  fuel1.. coal1 =E= (QS_Max/0.85)*x1/coal_energy;
1513  fuel2.. NG =E= (QS_Max/0.85)*x2/NG_energy;
1514  fuel3.. coal2 =E= (QS_Max/0.85)*x3/coal_energy
1515   
1516  *Units cost per kg and per m3.
1517   
1518   
1519  ***Environmental Emissions calculations***
1520  Variables
1521  emission;
1522   
1523  parameter
1524  coalef /0.000088/
1525  ngef   /0.0000503/;
1526   
1527  equations Envimpact1;
1528   
1529  Envimpact1.. emission =E= fc('FAME','Col5','HX22')*2.20462*3.92*10**(-4) +
       (x1*QS_Max/0.85)*coalef+(x2*QS_Max/0.85)*ngef;
1530   
1531   
1532   
1533   
1534   
1535   
1536  ** Objective function calculations **
1537  Variables
1538           Manuf_cost      Total manufacturing cost
1539           Revenue         Revenue from sale of products
1540           CI             Total capital investment
1541           PV              Present value
1542           NPV1            Total NPV
1543           Dep             Depreciation
1544           Cw              Working capital
1545           Cash_flow       Total cash flow
1546           NPV2            Annualized NPV;
1547   
1548   
1549  Scalar
1550           FCI             Fixed Capital Investment /3219315/
1551           tax             tax rate                /0.05/;
1552   
1553   
1554   
1555   
1556   
1557   
1558   
1559   
1560  parameter demand /0.5318004825/;
1561   
1562   
1563  $Include valuechain.gms
****                        $282
1564   
1565   
1566   
1567   
1568   
1569  Equations
1570           Cost1, Cost2, Cost3, Cost4, Cost5, Cost6, Cost7, Cost8;
1571  Cost1..
1572           Manuf_cost =E= 347608   + Cost_KOH*fc('KOH','Src5','Mix3')*Annual
       + Cost_MeOH*fc('MeOH','Src3','Mix2')*Annual + Cost_PhosA*fc('PhosA','Src7
      ','Reactor4')*Annual
1573                             + Cost_Oil*fc('Oil','Src','Mix3')*Annual + coal
      1*Annual*pricex1 + coal2*Annual*pricex4 + NG*annual*pricex2 + pricex3*Annu
****                 $140                   $140                $140      $140
      al;
1574  *Here WaterC is the water consumed in the coal CHP in Kg/hour
1575  *+
1576  Cost2..
1577           Revenue =E= Cost_FAME*fc('FAME','Col5','HX22')*Annual + Cost_Glyc
      erol*fc('Glycerol','Col4','HX18')*Annual +
1578                   Cost_PotPhos*fc('PotPhos','Reactor4','Snk3')*Annual;
1579  *Electricity sold in one year
1580  Cost3..
1581           Cash_flow =E= Revenue - Manuf_cost;
1582   
1583  Cost4..
1584           CI =E= FCI;
1585  Cost5..
1586           Cw =e= 0.15*CI;
1587  *Working capital for plant
1588   
1589  Cost6..
1590           Dep =e= (FCI  - 39600)/20;
1591  *Depreciation calculated based on straight line depreciation method. Salva
      ge cost is assumed to be zero. Since land value does not depreciate, depre
      ciation should be calculated without including land cost in fixed capital 
      investment costs
1592  *Depreciation is calculated for all "Technological" equipments
1593   
1594   
1595  Cost7..
1596           NPV1 =E= (-(CI + Cw) + (((Revenue - Manuf_cost)*(1-tax))*(1 - (1.
      07)**(-20)))/0.07 + (Dep*tax)*(1 - (1.07)**(-20))/0.07 + Cw/(1.07)**20);
1597  Cost8..
1598          NPV2*(1-(1.07)**(-20)) =e= NPV1*0.07;
1599   
1600   
1601   
1602   
1603   
1604   
1605   
1606  *Execute_Unload "ATE.gdx",ATE.l;
1607  *Execute_Unload "ECO.gdx",Eco.l;
1608   
1609   
1610   
1611   
       
      loop(c1,
      put FD.L(c1) /;
      );
      putclose;
       
       

**** LIST OF STRAY NAMES - CHECK DECLARATIONS FOR SPURIOUS COMMAS
**** STRAY NAME FAME_23 OF TYPE EQU  
GAMS Rev 235  WEX-VS8 23.5.1 x86/MS Windows             08/13/19 14:45:02 Page 2
: Biodiesel TES Model - 1/19/2017
Error Messages


140  Unknown symbol
282  Unable to open include file

**** 5 ERROR(S)   0 WARNING(S)


COMPILATION TIME     =        0.094 SECONDS      3 Mb  WIN235-235 Jul  2, 2010


USER: Gary Goldstein                                 G010614:2121CA-WIN
      Decision Ware, Inc.                                        DC2807


**** FILE SUMMARY

Input      C:\Users\ghosh.117\Google Drive\box\Research_compile\P2PTES\Spatial\C
           o2\Supply Chain P2P TES\biodieselprocess.gms
Output     C:\Users\ghosh.117\Documents\gamsdir\projdir\biodieselprocess.lst

**** USER ERROR(S) ENCOUNTERED
